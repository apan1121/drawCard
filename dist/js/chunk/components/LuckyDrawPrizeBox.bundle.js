"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[599],{6591:(e,r,n)=>{n.r(r),n.d(r,{default:()=>k});var t=n(3967),i=["prize-sn"],a={class:"content-wrapper"},o={class:"prize-header"},c={class:"prize-button"},s=["disabled"],d={class:"prize-draw-content"},l=[(0,t.createElementVNode)("div",{class:"icon"},[(0,t.createElementVNode)("i",{class:"fas fa-gift"})],-1)];var p=n(2678),f=n(6247),u=n(988),m=n(6300);function w(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function I(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?w(Object(n),!0).forEach((function(r){g(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function g(e,r,n){return(r=function(e){var r=function(e,r){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,r||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==typeof r?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var y={ding:new Audio("./dist/mp3/ding.mp3"),dong:new Audio("./dist/mp3/dong.mp3")};const z={components:{CardBox:(0,t.defineAsyncComponent)((()=>n.e(814).then(n.bind(n,9741)))),CardInfoBox:(0,t.defineAsyncComponent)((()=>n.e(455).then(n.bind(n,4315))))},filters:{},props:{prizeInfo:{type:Object,default:()=>({})}},data:()=>({mask:!0,drawing:!1,cardIds:[],focusIndex:!1,winnerPlayer:null}),computed:I(I({},(0,p.mapGetters)({config:"config",prizeCardMapping:"prizeCardMapping",waitCardSN:"waitCardSN",lockDrawItByPrizeSN:"lockDrawItByPrizeSN",validCardList:"validCardList",winnerAudio:"winnerAudio"})),{},{luckyDrawBool(){var e=this,r=!0,n=JSON.parse(JSON.stringify(e.cardIds)).filter((e=>!1===e)).length;return(0===e.prizeInfo.cnt||e.drawing||e.lockDrawItByPrizeSN||0===this.canUseCardSN.length||0===n)&&(r=!1),r},canUseCardSN(){var e=this;return e.waitCardSN.filter((r=>!e.cardIds.includes(r)))}}),watch:{prizeInfo:{immediate:!0,handler(e,r){this.resetCardIds(),this.setWinnerPlay()}},prizeCardMapping:{immediate:!0,handler(e,r){this.resetCardIds()}}},beforeCreate(){},created(){},mounted(){var e=this;m(e.$refs.box).bind("getEmptyCardIdCnt",((r,n)=>{var t=JSON.parse(JSON.stringify(e.cardIds)).filter((e=>!1===e)).length;"function"==typeof n&&n(t)}))},updated(){},unmounted(){},methods:I(I(I({},(0,p.mapActions)({})),(0,p.mapMutations)({lockDrawIt:"lockDrawIt",setCardIdsByPrizeSN:"setCardIdsByPrizeSN"})),{},{setWinnerPlay(){var e=this;e.prizeInfo.audio&&e.winnerAudio[e.prizeInfo.audio]?e.winnerPlayer=new Audio("./dist/mp3/".concat(e.winnerAudio[e.prizeInfo.audio])):e.winnerPlayer=null},resetCardIds(){var e=this;clearTimeout(e.resetCardIdsTimer),e.resetCardIdsTimer=setTimeout((()=>{var r=this.prizeInfo,n=r.sn,t=r.cnt,i=[];if(e.prizeCardMapping[n]&&Array.isArray(e.prizeCardMapping[n])&&(i=JSON.parse(JSON.stringify(e.prizeCardMapping[n]))),i.length<t)for(var a=i.length-1;a<t;a+=1)i[a]=!1;e.cardIds=i}),100)},openMask(){var e=this;m(e.$refs.box).find(".mask-wrapper").fadeOut((()=>{e.mask=!1})),u.XD.mixpanel("DrawPrizeMask_click",{prizeSN:e.prizeInfo.sn,title:e.prizeInfo.title,desc:e.prizeInfo.desc}),u.XD.gtag("event","DrawPrizeMask_click",{prizeSN:e.prizeInfo.sn,title:e.prizeInfo.title,desc:e.prizeInfo.desc})},drawIt(){var e=this;e.actionDraw(),e.lockDrawIt(e.prizeInfo.sn),u.XD.mixpanel("DrawPrizeDrawIt_click",{prizeSN:e.prizeInfo.sn,title:e.prizeInfo.title,desc:e.prizeInfo.desc}),u.XD.gtag("event","DrawPrizeDrawIt_click",{prizeSN:e.prizeInfo.sn,title:e.prizeInfo.title,desc:e.prizeInfo.desc})},actionDraw(){var e=this;clearTimeout(e.randDrawTimer),e.drawing=!0;var r=JSON.parse(JSON.stringify(e.cardIds));for(var n in e.focusIndex=!1,r)if(!1===r[n]){e.focusIndex=parseInt(n);break}var t=e.canUseCardSN,i=t.length;if(!1===e.focusIndex)e.setCardIdsByPrizeSN({prizeSN:e.prizeInfo.sn,cardIds:r}),e.winnerPlayer?(e.winnerPlayer.pause(),e.winnerPlayer.currentTime=0,e.winnerPlayer.onended=function(){e.drawEnd()},e.winnerPlayer.play()):e.drawEnd();else if(!1!==e.focusIndex&&0===i)e.setCardIdsByPrizeSN({prizeSN:e.prizeInfo.sn,cardIds:r}),e.winnerPlayer?(e.winnerPlayer.pause(),e.winnerPlayer.currentTime=0,e.winnerPlayer.onended=function(){e.drawEnd()},e.winnerPlayer.play()):e.drawEnd(),f.Z.warning({title:this.$t("common.popup.Warning"),html:this.$t("common.Alert.DrawItNotEnough"),confirmButtonText:this.$t("common.Button.Confirm")});else{var a=!1;e.randDrawTimer=setInterval((()=>{if(i>0){var r=Math.pow(10,"".concat(i).length),n=parseInt(Math.random()*r%i);a=t[n];var o=JSON.parse(JSON.stringify(e.cardIds));o[e.focusIndex]=a,e.cardIds=o,y.ding.pause(),y.ding.currentTime=0,y.ding.play()}else clearTimeout(e.randDrawTimer),e.drawNext()}),e.config.randomDrawWait),e.drawNextTimer=setTimeout((()=>{clearTimeout(e.randDrawTimer),e.drawNext()}),e.config.drawNextWait)}},drawNext(){var e=this;clearTimeout(e.drawNextTimer),e.focusIndex+=1,y.dong.pause(),y.dong.currentTime=0,y.dong.play(),e.actionDraw()},drawEnd(){var e=this;clearTimeout(e.drawEndTimer),e.drawEndTimer=setTimeout((()=>{e.lockDrawIt(!1),e.drawing=!1,m("body").trigger("drawEnd")}),500),u.XD.mixpanel("DrawPrizeDrawResult_trigger",{prizeSN:e.prizeInfo.sn,title:e.prizeInfo.title,desc:e.prizeInfo.desc,cardIds:e.cardIds}),u.XD.gtag("event","DrawPrizeDrawResult_trigger",{prizeSN:e.prizeInfo.sn,title:e.prizeInfo.title,desc:e.prizeInfo.desc,cardIds:e.cardIds})}})};const k=(0,n(4407).Z)(z,[["render",function(e,r,n,p,f,u){var m=(0,t.resolveComponent)("card-box"),w=(0,t.resolveComponent)("card-info-box");return(0,t.openBlock)(),(0,t.createElementBlock)("div",{ref:"box",class:(0,t.normalizeClass)(["lucky-draw-prize-box",{mask:f.mask,"un-focus":!1!==e.lockDrawItByPrizeSN&&n.prizeInfo.sn!=e.lockDrawItByPrizeSN}]),"prize-sn":n.prizeInfo.sn},[(0,t.createElementVNode)("div",a,[(0,t.createElementVNode)("div",o,[(0,t.createElementVNode)("div",{class:"prize-title",style:(0,t.normalizeStyle)({color:e.config.PrizeTitleColor})},(0,t.toDisplayString)(n.prizeInfo.title)+" ["+(0,t.toDisplayString)(n.prizeInfo.cnt)+"] ",5),(0,t.createElementVNode)("div",c,[(0,t.createElementVNode)("button",{type:"button",class:"btn btn-success btn-sm",disabled:!u.luckyDrawBool,onClick:r[0]||(r[0]=function(){return u.drawIt&&u.drawIt(...arguments)})},(0,t.toDisplayString)(e.$t("common.Button.DrawIt")),9,s)])]),n.prizeInfo.desc?((0,t.openBlock)(),(0,t.createElementBlock)("div",{key:0,class:"prize-description",style:(0,t.normalizeStyle)({color:e.config.PrizeDescColor,"background-color":e.config.PrizeDescBgColor})},(0,t.toDisplayString)(n.prizeInfo.desc),5)):(0,t.createCommentVNode)("",!0),(0,t.createElementVNode)("div",d,[f.drawing?(0,t.createCommentVNode)("",!0):((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,{key:0},(0,t.renderList)(f.cardIds,((e,r)=>((0,t.openBlock)(),(0,t.createElementBlock)("div",{key:"".concat(n.prizeInfo.sn,"_").concat(r),class:"card-item"},[(0,t.createVNode)(m,{sn:e,"click-focus":!1!==e},null,8,["sn","click-focus"])])))),128)),f.drawing?((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,{key:1},(0,t.renderList)(f.cardIds,((r,i)=>((0,t.openBlock)(),(0,t.createElementBlock)("div",{key:"".concat(n.prizeInfo.sn,"_").concat(i),class:"card-item"},[f.focusIndex===i?((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,{key:0},[(0,t.withDirectives)((0,t.createVNode)(w,null,null,512),[[t.vShow,!1===r]]),((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(e.validCardList,(e=>(0,t.withDirectives)(((0,t.openBlock)(),(0,t.createBlock)(w,{key:e.sn,"card-info":e},null,8,["card-info"])),[[t.vShow,r===e.sn]]))),128))],64)):((0,t.openBlock)(),(0,t.createBlock)(m,{key:1,sn:r},null,8,["sn"]))])))),128)):(0,t.createCommentVNode)("",!0)])]),(0,t.createElementVNode)("div",{class:"mask-wrapper",onClick:r[1]||(r[1]=function(){return u.openMask&&u.openMask(...arguments)})},l)],10,i)}]])}}]);